<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reproductor de Audio con Conmutación Automática</title>
</head>
<body>
    <h1>Reproductor de Audio con Conmutación Automática</h1>

    <!-- Dos reproductores de audio: uno para la transmisión y otro para el archivo local -->
    <audio id="streamPlayer" controls autoplay></audio>
    <audio id="backupPlayer" controls style="display:none"></audio>

    <script>
        const streamUrl = "https://c26.radioboss.fm:8581/stream";
        const localBackup = "AEROSUR1.mp3";
        const streamPlayer = document.getElementById('streamPlayer');
        const backupPlayer = document.getElementById('backupPlayer');
        let usingStream = true;

        // Configurar las fuentes de audio
        streamPlayer.src = streamUrl;
        backupPlayer.src = localBackup;

        // Función para iniciar el reproductor de transmisión en vivo
        function startStream() {
            backupPlayer.pause();
            backupPlayer.style.display = 'none';
            streamPlayer.style.display = 'block';
            streamPlayer.play().catch(error => console.log("Error al iniciar la transmisión:", error));
        }

        // Función para iniciar el reproductor del archivo local
        function startBackup() {
            streamPlayer.pause();
            streamPlayer.style.display = 'none';
            backupPlayer.style.display = 'block';
            backupPlayer.play().catch(error => console.log("Error al iniciar el archivo local:", error));
        }

        // Iniciar con la transmisión en vivo
        startStream();

        // Detectar errores en el stream y cambiar al archivo local
        streamPlayer.addEventListener('error', () => {
            console.log("Transmisión en vivo fallida. Cambiando al archivo local.");
            usingStream = false;
            startBackup();
        });

        // Intento de reconexión cada 5 segundos si estamos en el archivo local
        setInterval(() => {
            if (!usingStream) {
                fetch(streamUrl, { method: "HEAD" })
                    .then(response => {
                        if (response.ok) {
                            console.log("Transmisión en vivo disponible nuevamente. Reconectando...");
                            usingStream = true;
                            startStream();
                        }
                    })
                    .catch(error => console.log("Transmisión en vivo aún no disponible.", error));
            }
        }, 5000); // Intervalo de 5 segundos para verificar el estado de la transmisión

    </script>
</body>
</html>
